# Il Mercatino del Libro client (@ilmercatinodellibro/client)

## Dev quick start

The following instructions are meant only for development.

1. Follow the server setup, as GraphQL helpers generation require the files generated by the server to be run
2. To run PostgreSQL on Docker:
   ```bash
   $ pnpm run db:start
   ```
3. Once the container is running, run the following commands:
   ```bash
   $ pnpm run migrate:dev
   $ pnpm run dev
   ```

## Test

```bash
# component tests
$ pnpm run test:component

# e2e tests
# - build&serve the app then launch Cypress in "open" mode (interactive)
$ pnpm run test:e2e
# - launch dev server then open Cypress in "open" mode (interactive)
# Pages take longer to load initially on Vite dev server, so tests may fail, just re-run them
$ pnpm run test:e2e:dev
# - build&serve the app then launch Cypress in "run" mode (headless)
$ pnpm run test:e2e:ci

# keep this running in a separate terminal while running e2e tests
$ pnpm start:server # start the server app with the related env variables overridden, to use with e2e tests
```

## Push notifications

We are using [FCM(Firebase Cloud Messaging)](https://firebase.google.com/docs/cloud-messaging) to send push notifications to the users.

This feature can be enabled/disabled through the environment variable `PUSH_NOTIFICATIONS_ENABLED` in the `.env` file. If you don't care about push notifications you can leave it disabled, for ease of setting up the environment.

A service worker is required for the feature to work, so you must use PWA mode to be able to use it. If you don't use PWA mode, it will not fail, but it will not work either.

When enabled, it needs some configuration to work. Here are the steps to follow:

- Create a Firebase project for free, then register a new app for each platform you want to support (Web, Android(Native), iOS(Native)): https://firebase.google.com/docs/web/setup#create-firebase-project-and-app
- Generate a new VAPID key pair, and set `WEB_PUSH_VAPID_KEY` to the public key: https://firebase.google.com/docs/cloud-messaging/js/client#generate_a_new_key_pair
- Get the Firebase config and set the relevant environment variables: https://firebase.google.com/docs/web/learn-more#config-object
  - `FIREBASE_API_KEY`: `apiKey`
  - `FIREBASE_APP_ID`: `appId`
  - `FIREBASE_MESSAGING_SENDER_ID`: `messagingSenderId`
  - `FIREBASE_PROJECT_ID`: `projectId`

Also see [Server README | Push notifications](../server/README.md#push-notifications) for setting up and configuring the server.

## Social login

This feature can be enabled/disabled through some environment variables for related providers in the `.env` file. You can leave some or all of the providers as disabled, for ease of setting up the environment. See the `.env.example` file for the list of available providers and their related environment variables.

When a specific provider is enabled, it needs some configuration on the server app to work. See [Server README | Social login](../server/README.md#social-login) for setting up and configuring the server.

## Adding Operators

When going into the `Roles and Permissions` page, new Operators can be added by pressing onto the **Add new Operator** button on the top-right: a dialog with a text field to insert the e-mail address of the person that the Admin wants to add to the list of Operators for the selected Retail Location will appear.

> **Note:** When clicking onto the text field a list of the addresses of the currently registered Customers (<u>with a verified e-mail</u>) will be shown, <u>but an address that isn't present in this list **can still be set** by typing it in and then pressing enter</u>.
